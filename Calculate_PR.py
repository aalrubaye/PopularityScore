import pprint
import urllib2
from pymongo import MongoClient
import matplotlib.pyplot as plt
import simplejson
from datetime import datetime, timedelta
import time

__author__ = 'Abdul Rubaye'

client = MongoClient()
database = client.github_10_01_2018
events = database.events
final_db = database.final


totalMonthlyForks = [0] * 88
totalMonthlyStars = [0] * 88
fork_weight = [0] * 88
star_weight = [0] * 88
months = list(range(88))


def year_multiplier(month):
    if month < 12:
        return 0
    elif month < 24:
        return 1
    elif month < 36:
        return 2
    elif month < 48:
        return 3
    else:
        return 4

# 1 weeks
# W_f_m = [0.00044316040075389345, 0.0007791885725622458, 0.0007328142049399861, 0.0007710048606289059, 0.0007315742485864497, 0.0008079555599642893, 0.0008255629401845055, 0.0008471381807360381, 0.0008947525047118341, 0.0008697053863703998, 0.0008404424164269418, 0.000922031544489634, 0.0008783850808451542, 0.000813163376649142, 0.0008446582680289654, 0.0008595377442714016, 0.0008984723737724432, 0.0008307707568693582, 0.0008910326356512251, 0.0009582382700128955, 0.0009396389247098502, 0.0008652415434976688, 0.0011355520285685943, 0.000911119928578514, 0.000878137089574447, 0.0010207320702311279, 0.0009321991865886321, 0.0010956254339847238, 0.001072066263267533, 0.0010356115464735642, 0.000908392024600734, 0.0009855173097906955, 0.0009847733359785735, 0.000987005257414939, 0.0009579902787421883, 0.0009917170915583772, 0.0010306517210594186, 0.0009907251264755482, 0.0010284197996230534, 0.0010006447773038389, 0.001017260192441226, 0.0010961214165261383, 0.00112141652613828, 0.0011142247792877691, 0.0012602916377343518, 0.0012692193234798135, 0.0012228449558575538, 0.0011702708064676123, 0.00124863604801111, 0.001216645174089872, 0.0011759746056938796, 0.0009259994048209502, 0.0, 0.0009574942962007737, 0.0012905465727606389, 0.0012652514631484972, 0.0013535363555202858, 0.0013696557881162582, 0.0014368614224779287, 0.0013257613332010713, 0.0011576232516615414, 0.0013406408094435076, 0.0014899315544092849, 0.0015918559666699731, 0.0016312865787124293, 0.0016528618192639618, 0.0015829282809245115, 0.001624590814403333, 0.0016015276262275567, 0.001604503521476044, 0.001490923519492114, 0.00166302946136296, 0.0016836127368316635, 0.0017917369308600337, 0.0017027080646761234, 0.0016786529114175182, 0.0017022120821347088, 0.0016781569288761035, 0.0016486459676619382, 0.0017037000297589525, 0.0017585061005852595, 0.0017180835234599742, 0.0017793373673246702, 0.0017833052276559865, 0.0018098402936216646, 0.0017076678900902688, 0.002038736236484476, 0.0019534272393611743, 0.001871590120027775, 0.0020238567602420396, 0.0019626029163773437, 0.0021228052772542406, 0.0019172205138379128, 0.0020878385080845153, 0.002200178553714909, 0.002227209602222002, 0.0023606289058625135, 0.00233458982243825, 0.002225473663327051, 0.0024253546275171114, 0.0023137585556988393, 0.0025461263763515525, 0.002365588731276659, 0.0024119630988989186, 0.001992113877591509, 0.001955907152068247, 0.002491072314254538, 0.002564725721654598, 0.002765102668386073, 0.002773782362860827, 0.002395099692490824, 0.0021426445789108225, 0.0027182323182223986, 0.0027343517508183713, 0.0029875508382104948, 0.0030279734153357803, 0.0030073901398670767, 0.0030321892669378037, 0.0029250570379922626, 0.0030044142446185892, 0.003042356909036802, 0.0031177462553318123, 0.003018549747048904, 0.002746999305624442, 0.003249181628806666, 0.00323703005654201, 0.003120970141851007, 0.003181232020632874, 0.002928280924511457, 0.003108322587044936, 0.003011358000198393, 0.0030592203154448964, 0.0029538240253943063, 0.003059716297986311, 0.003151969050689416, 0.0032020632873722846, 0.003188175776212677, 0.0032268624144430116, 0.0031752802301358994, 0.0034592302350957248, 0.0036509274873524453, 0.003509820454320008, 0.003436415038190656, 0.003768475349667692, 0.0036353040372978872, 0.0035177561749826407, 0.0040147306814800115, 0.0039748040868961415, 0.003860480111100089, 0.003895942862811229, 0.0037022616803888504, 0.00415211784545184, 0.003827249280825315, 0.004247346493403433, 0.004304384485666104, 0.004130046622358893, 0.003793522468009126, 0.0033287868267037, 0.0, 0.004135998412855868, 0.004346295010415634, 0.004264457891082234, 0.003519988096419006, 0.0037652514631484973, 0.004739113183215951, 0.004861124888403928, 0.005075141355024303, 0.005259150877889098, 0.005329580398769964, 0.005422081142743776, 0.005228895942862811, 0.005488542803293324, 0.005010663624640413, 0.005098452534470787, 0.0051306913996627315, 0.005015127467513144, 0.004756720563436167, 0.005125235591707172, 0.005187977383196112, 0.005320652713024502, 0.004597758158912806, 0.005154994544192044, 0.005191449260986013, 0.005264854677115366, 0.00531172502727904, 0.0052899017954568, 0.005578315643289356, 0.005836722547366333, 0.005915335780180537, 0.005567404027378237, 0.005705535165162186, 0.005682223985715703, 0.005671808352345997, 0.005854081936315841, 0.006147207618291836, 0.006417766094633469, 0.00686390239063585, 0.006644926098601329, 0.00567156036107529, 0.007499256026187878, 0.007830324372582085, 0.008603313163376649, 0.0078057732367820655, 0.007073950996924908, 0.0070387362364844755, 0.006641454220811427, 0.007529262969943458, 0.007643834937010217, 0.007052127765102669, 0.007036008332506696, 0.006095129451443309, 0.0, 0.0073140065469695465, 0.008069139966273188, 0.008222398571570281, 0.008113778395000496, 0.008015821843071124, 0.010064229739113183, 0.007504215851602024, 0.00739460370994941, 0.008591657573653407, 0.00866233508580498, 0.008817329629997024, 0.008840888800714215, 0.008478821545481598, 0.008162880666600536, 0.008754835829778792, 0.008765995436960619, 0.008648943557186787, 0.0075582779486162086, 0.008134361670469199, 0.00862588036901101, 0.008240501934331911, 0.00819983136593592, 0.00871689316536058, 0.008119978176768178, 0.007833796250371988, 0.008004166253347883, 0.007932992758654896, 0.008196855470687431, 0.008144033330026784, 0.00831142743775419, 0.008284148397976391, 0.008536355520285687, 0.008343418311675429, 0.008592897530006943, 0.008666550937407003, 0.009213371689316536, 0.008973564130542604, 0.009469794663227855, 0.010875657176867374, 0.012419154845749429, 0.011384535264358694, 0.01139767880170618, 0.01190482095030255, 0.0097237377244321, 0.0009731177462553318, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
# W_s_m = [0.0006367115803252565, 0.000995732265945643, 0.0007592187227569316, 0.0008112480849215653, 0.0009142818971340322, 0.0008041942780000564, 0.0008460348079447329, 0.0007820079451187294, 0.0008992096601222612, 0.0008841977120585372, 0.0007782700303398103, 0.0008653875602678469, 0.0008838962673183017, 0.0007464374657709498, 0.0007318475403435554, 0.0008280084124786547, 0.0010204507346449475, 0.0008957731900835773, 0.0008915529637202815, 0.0009684213724803139, 0.0009051179770308755, 0.0008892619836944923, 0.0010976808770932624, 0.0009257367972629782, 0.0008340975962314102, 0.0011502528397903198, 0.0008975215695769428, 0.0013209911406596624, 0.0011994486213967406, 0.001069586227303321, 0.0010733844310302876, 0.0010027860728671519, 0.0009951896654132192, 0.0010526450329020906, 0.001186787942306853, 0.00127348344959856, 0.0011431387439207639, 0.000988618170076087, 0.0010228020036187838, 0.001043722268591122, 0.0010268413631379385, 0.0011602608051661358, 0.0011857027412420053, 0.0011593564709454296, 0.0014908853962563456, 0.001497517180541525, 0.0014565206958695076, 0.0013218351859323216, 0.0013716338570192131, 0.0013528237052285229, 0.0014214325281061047, 0.0011556185561665104, 0.0, 0.0011581506919844879, 0.0014065411579384749, 0.001381460955550888, 0.001748078048625207, 0.0016748872656960467, 0.001518377156565816, 0.0014138964096002192, 0.0014468744641819742, 0.0014697842644398663, 0.0016251488835572023, 0.0017949828502058385, 0.0015903621605340347, 0.0017477766038849715, 0.001713833926134463, 0.0017928727370241906, 0.0016467926159061054, 0.0018520161950583802, 0.0014816611872051418, 0.001652218621230343, 0.0017138942150825103, 0.001871971836861965, 0.0017005703575641046, 0.0016082076891559716, 0.0016582475160350516, 0.0017331866784575773, 0.0017935962044007556, 0.0018563569993177702, 0.0018280211937356406, 0.0017343924574185188, 0.0017768961657917133, 0.0020469303640946036, 0.0019861591044631425, 0.0018638931178236557, 0.0020311949486543144, 0.0020332447728879156, 0.0020788835065595583, 0.002080511308156829, 0.0020807524639490176, 0.00250126787657743, 0.0022035610511209284, 0.0025525737713654986, 0.002590555808635162, 0.00269232355293864, 0.0025115772866934815, 0.0028350274929660885, 0.002647287708747468, 0.00290839914273939, 0.0027075163678465055, 0.00331655532101815, 0.0026854506128612724, 0.002813926361149609, 0.002493972913863733, 0.002444475687517077, 0.0026832802107315773, 0.002639992746033771, 0.0029142471706999572, 0.002864870522249395, 0.002680024607537035, 0.0025429275396779655, 0.002959946193319647, 0.0030911952332181494, 0.0031636022598226974, 0.0033372947191463473, 0.003053152907000439, 0.003121701440929974, 0.002958680125410658, 0.003144611241187866, 0.003084503159984923, 0.0030615933597270308, 0.003408194522049718, 0.00281742312013634, 0.003500557190457851, 0.00362215999866882, 0.00317740842892548, 0.0032640436472691397, 0.002943487310502793, 0.003177709873665715, 0.0029460797352688175, 0.002856068335834521, 0.0030161354928995294, 0.003352909556690542, 0.0033913739055445816, 0.0031215205740858327, 0.0032130994861693535, 0.003169570865679359, 0.0033199917910568338, 0.0036662915086392855, 0.003585444029308146, 0.0033676200600140306, 0.0035887599214507356, 0.003686066283598729, 0.0035730847949584934, 0.0033769045580132814, 0.0037040323901167604, 0.003917334688307344, 0.0036294549613825173, 0.0038326890052492383, 0.003897620202295948, 0.004131119298082305, 0.003703791234324572, 0.0041882732208309405, 0.004237529291385408, 0.00448748726998862, 0.003916370065138591, 0.0035943065046710673, 0.0, 0.004115745616330299, 0.004230174039723664, 0.004234997155567431, 0.0037107244633499867, 0.004416406600241107, 0.004802919046170965, 0.005366922155151437, 0.005417203137822705, 0.005416961982030517, 0.004978540751832121, 0.005263164875562405, 0.004952315059431639, 0.0057547609579383305, 0.005659263264231749, 0.00538567201799408, 0.005357215634515857, 0.005015317010140842, 0.0046713685615322265, 0.005608138236287821, 0.00563008341337696, 0.005394655071253096, 0.0044044090995797374, 0.005197449922191084, 0.005036538719853416, 0.005024541219192046, 0.005483520980674499, 0.005136678662559623, 0.0055649713494861095, 0.005607173613119068, 0.005535731209683273, 0.005364088574593224, 0.005596321602470593, 0.005445960966041165, 0.005573110357472466, 0.0058420593547105085, 0.006185404913838653, 0.006431745555559039, 0.0063288323212426665, 0.006163278869905373, 0.0054663989194291265, 0.007247274155791947, 0.006925090017428329, 0.006482870583502966, 0.0070292090307056436, 0.006550092760575465, 0.006603810213285417, 0.006857747262459736, 0.009271294719628658, 0.008120318412461774, 0.007358929287575147, 0.00806539518079088, 0.00651856164074684, 0.0, 0.008331872331158993, 0.008989865910144869, 0.008970995469406133, 0.00803603446309195, 0.00789833450575241, 0.008861932762388957, 0.00752966758844449, 0.008085833134178842, 0.009004817569260547, 0.00857013425384107, 0.008409343629399496, 0.008355807043533685, 0.007944274684164287, 0.007515921708289754, 0.008093489830580822, 0.00910152104192807, 0.008669249284430476, 0.007409752870778839, 0.0076197392768268335, 0.0077420052634663205, 0.007923173552347808, 0.007680631114354388, 0.0081435296574599, 0.007678038689588364, 0.007433506716309391, 0.007183609026654226, 0.0069994262903703836, 0.007263733038608802, 0.00727554967242603, 0.007587122955933361, 0.0076245623926706006, 0.008185309898456531, 0.007336381221005538, 0.008360328714637216, 0.00839993855350415, 0.009152947514612233, 0.009070954545268198, 0.009924163738030534, 0.012384254263091806, 0.010261239246561782, 0.009534938289438558, 0.008333861866444546, 0.011059826652393459, 0.008379802044856425, 0.0010850201980033747, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]

# two weeks
# W_f_m = [0.0012223489733161393, 0.0015038190655688919, 0.001539529808550739, 0.0016727011209205435, 0.001764457891082234, 0.0017624739609165758, 0.001691548457494296, 0.001704196012300367, 0.0017292431306418015, 0.0018492709056641206, 0.001804880468207519, 0.0020466719571471084, 0.0018988691598055749, 0.002027824620573356, 0.002107677809741097, 0.0018939093343914295, 0.0019717785933935127, 0.0019497073703005653, 0.0020213768475349668, 0.0020290645769268922, 0.0021133816089673645, 0.002235641305426049, 0.002529510961214165, 0.002393115762325166, 0.002465281222100982, 0.00210197401051483, 0.0009574942962007737, 0.002555798035909136, 0.0027231921436365438, 0.002762622755679, 0.002498264061105049, 0.003081787521079258, 0.003284148397976391, 0.0032075190953278444, 0.003206031147703601, 0.003153952980855074, 0.003475349667691697, 0.0033813609760936416, 0.0033803690110108123, 0.0033523459974208907, 0.0034765896240452334, 0.0035626425949806567, 0.003517508183711933, 0.00399216347584565, 0.0038954468802698144, 0.004085408193631584, 0.004005059021922428, 0.004427388155936911, 0.004695218728300764, 0.004650828290844162, 0.004859884932050392, 0.004777551830175578, 0.003948021029659756, 0.005055798035909136, 0.0055388850312469, 0.004537744271401647, 0.0054525840690407695, 0.0060155242535462755, 0.00603957940680488, 0.005929471282610852, 0.006160103164368614, 0.005765549052673346, 0.006486211685348676, 0.00630220216248388, 0.006036603511556393, 0.006070578315643289, 0.006013540323380617, 0.0063540323380617, 0.006415038190655689, 0.006634510465231624, 0.007160747941672453, 0.007204890387858347, 0.0071530602122805275, 0.007989534768376154, 0.007756422973911319, 0.00785437952584069, 0.008074595774228747, 0.008434431108024998, 0.0071223092947128265, 0.004135998412855868, 0.008610752901497867, 0.007285239559567503, 0.009600238071619879, 0.010334292232913402, 0.01075166154151374, 0.010717438746156136, 0.0101091161591112, 0.010145818867175875, 0.009881956155143338, 0.010508630096220613, 0.00975275270310485, 0.01045630393810138, 0.010601626822735839, 0.01141503819065569, 0.011482739807558774, 0.011387759150877889, 0.01152589028866184, 0.012564973712925306, 0.013508828489237179, 0.013170816387263168, 0.016433637535958733, 0.014879724233706974, 0.013680190457295903, 0.015173097906953675, 0.014088136097609364, 0.006095129451443309, 0.015383146513242733, 0.016336176966570776, 0.018080051582184307, 0.014898819561551433, 0.017253992659458386, 0.017658218430711237, 0.016641702212082134, 0.017520831266739412, 0.016207221505802994, 0.01676024203948021, 0.01644033330026783, 0.016836871342128756, 0.01583796250371987, 0.01612984822934233, 0.016455460767780976, 0.016820503918262078, 0.016936315841682374, 0.01787992262672354, 0.01844335879377046, 0.023294812022616802, 0.022782214066064874, 0.02162855867473465, 0.0009731177462553318, 0.0, 0.0, 0.0]
# W_s_m = [0.0016324438462708994, 0.001570466807678497, 0.0017184761751340887, 0.0016280427530634624, 0.0017834073721807984, 0.0016436575906076572, 0.0016303337330892515, 0.00155985595282221, 0.001916223924728525, 0.0018599743362005953, 0.0017943799607253678, 0.0020234176743562406, 0.00198435043602173, 0.0022185127102366054, 0.0022690348487000617, 0.0020761705038974394, 0.0020478346983153098, 0.002460271391905413, 0.002131756913996851, 0.002066524272209906, 0.0021871021683040745, 0.0023450592121874348, 0.0029884025767978706, 0.002778355881801829, 0.002724457562247736, 0.002577051084272615, 0.0011581506919844879, 0.002788002113489363, 0.003422965314321254, 0.0029322735661660355, 0.0029166587286218403, 0.0034201317337630406, 0.0033381387644190064, 0.003506706663158654, 0.0034988088109644856, 0.003133879808435485, 0.0035858660519444753, 0.0033087780467200762, 0.0033914341944926286, 0.003649953203718526, 0.0035624136511541596, 0.003823826529886317, 0.0038500522222867984, 0.00406443972154223, 0.0041593948147163875, 0.004582020340526448, 0.0047561348224864275, 0.005282879361573802, 0.00534660477965957, 0.005555686851486858, 0.006024071688864655, 0.005499376974010882, 0.0049384486013808095, 0.005323272956765349, 0.005779117692949352, 0.005222952147215, 0.006051141426537796, 0.006500896978969045, 0.006174854347930413, 0.006103291366598524, 0.006146096519711954, 0.006225617642186058, 0.0071227171891266716, 0.0064414520761946195, 0.006121197184168508, 0.0058021480711033385, 0.006369045049590071, 0.006512894479630414, 0.0063826703518487125, 0.00698628329969612, 0.0069530640893221765, 0.007274826205049464, 0.006949989352971775, 0.0076213670784241044, 0.007462143966631756, 0.008028739500378253, 0.007892064455155513, 0.00872501656137403, 0.007510676569809658, 0.004115745616330299, 0.008465171195291096, 0.008127131063591095, 0.010169841201322402, 0.010834165119853223, 0.010241705627394525, 0.01070707601736997, 0.01104493528222583, 0.0103725326446567, 0.010279506797820049, 0.011024738484630056, 0.009601859021770822, 0.010061079939045462, 0.01062019964323412, 0.011172144962605176, 0.010899819784276498, 0.011042282568511757, 0.011415169712182973, 0.012617150469397691, 0.012492111191148039, 0.012713673075221074, 0.013407960600931296, 0.013579301791281109, 0.013461557475745154, 0.017391613132090433, 0.015424324468366028, 0.00651856164074684, 0.017321738241303862, 0.017007029932498082, 0.016760267268141366, 0.015615500722623332, 0.017574951823101616, 0.01676515067293318, 0.015460196392454042, 0.01719501087250889, 0.016079002155209316, 0.015361744540293154, 0.015603804666702198, 0.015821568347048266, 0.014617115742963616, 0.014263159328979185, 0.014862672628359391, 0.015809872291127132, 0.015696709935642754, 0.017552886068116384, 0.01899511828329873, 0.022645493509653586, 0.017868800155883106, 0.019439628697249883, 0.0010850201980033747, 0.0, 0.0, 0.0]


# three months
# W_f_m = [0.0019551631782561254, 0.002310534669179645, 0.002567453625632378, 0.0026321793472869753, 0.0025362067255232617, 0.0025887808749132032, 0.002788909830373971, 0.0029119135006447773, 0.002831068346394207, 0.003203303243725821, 0.002878682670370003, 0.0029367126277155043, 0.00304979664715802, 0.003114026386271203, 0.0034959329431604007, 0.0036623350858049795, 0.0036412558277948617, 0.001883493701021724, 0.003909334391429421, 0.0041322785437952585, 0.003988195615514334, 0.004876004364646364, 0.004809046721555401, 0.004758456502331118, 0.005178057732367821, 0.00505902192242833, 0.00511085209800615, 0.005280726118440631, 0.005556244420196409, 0.005848874119630989, 0.006002628707469497, 0.006515226664021426, 0.006920692391627814, 0.007285239559567503, 0.0067696657077670865, 0.007011705187977383, 0.007933984723737724, 0.007595228647951592, 0.009022914393413352, 0.008961660549548656, 0.009178652911417519, 0.009233210990973118, 0.009230483086995337, 0.009178900902688225, 0.009165509374070032, 0.009617101478027974, 0.010285437952584069, 0.010714710842178355, 0.01116779089376054, 0.01173122706080746, 0.011681628806666006, 0.01268177760142843, 0.0071223092947128265, 0.012746751314353735, 0.012024352742783455, 0.01519541712131733, 0.01598055748437655, 0.015597658962404523, 0.014902539430612042, 0.015633865687927784, 0.014944201964090863, 0.015866481499851204, 0.017330373970836227, 0.016955163178256124, 0.017673097906953674, 0.01992659458387065, 0.021001140759845254, 0.02348303739708362, 0.02120945342723936, 0.02173197103461958, 0.013409135998412857, 0.024405316932843965, 0.02558426743378633, 0.024648596369407798, 0.02613703997619284, 0.025683711933339945, 0.024341583176272195, 0.02506621366927884, 0.024670667592500743, 0.02413401448269021, 0.024739609165757365, 0.02547267136196806, 0.026853486757266145, 0.03276460668584466, 0.034687035016367426, 0.010696855470687432, 0.0, 0.0]
# W_s_m = [0.002391662569027831, 0.0025297242600556538, 0.0025272524131857233, 0.0025278553026661945, 0.002362181273432807, 0.00274423233720718, 0.0027650923132314705, 0.002912679658050733, 0.0028818720055986727, 0.003590025989359724, 0.003071360169310659, 0.0035129164248075035, 0.003154558917615635, 0.0032308244368951964, 0.0038359446084437806, 0.004275873062343354, 0.004145890090353841, 0.0023137692481509983, 0.00453608016211457, 0.004607160831862082, 0.004541807612179043, 0.005133121614624845, 0.005153499279064759, 0.004985896003493865, 0.00528643640950858, 0.0049996418836486005, 0.005477974397454167, 0.005558218987304835, 0.005881247170941113, 0.006192639587604303, 0.006785581391647377, 0.007835453132939301, 0.007993892488407038, 0.008932470831604046, 0.007993349887874614, 0.007767748644282426, 0.008459142300486387, 0.008594068966215762, 0.009554049885969484, 0.009224992807528498, 0.009554291041761672, 0.009940140309263011, 0.009384939386697412, 0.008979857944769054, 0.009760418955134654, 0.009504190925934545, 0.010571727329004266, 0.010642446265063495, 0.010654021743088535, 0.0113794786549391, 0.011732530734702824, 0.012913289782204969, 0.007510676569809658, 0.012580916811621394, 0.012930050109762059, 0.01620108727500466, 0.015194020686826166, 0.01679969624016416, 0.015043901206188925, 0.01663287672091788, 0.014638397741624237, 0.015644740862426166, 0.01670787617228845, 0.016406371143104982, 0.017600574626021628, 0.018923856746707077, 0.019638763092649402, 0.020062172374784075, 0.022732852195373812, 0.0235446428808278, 0.014850433971905833, 0.02599689584264295, 0.024289934856585857, 0.02566078495728046, 0.02470942535709747, 0.024710932580798647, 0.02369874143203615, 0.023345809930168517, 0.023255075063357656, 0.021446768355633413, 0.02248723502102999, 0.023882019834099284, 0.026623840613384582, 0.03256965724768412, 0.028928626808276563, 0.0094648222428598, 0.0, 0.0]

# monthly
W_f_m = [0.0033146513242733855, 0.0033401944251562343, 0.0038205535165162187, 0.003730036702708065, 0.00395769268921734, 0.004174189068544787, 0.004603957940680488, 0.004207915881360976, 0.004366134312072215, 0.0048187183811129845, 0.005128955460767781, 0.005063733756571769, 0.005612786429917667, 0.005253199087392124, 0.0070449360182521575, 0.006909284793175281, 0.0072921833151473065, 0.007257960519789703, 0.007869506993353833, 0.00813163376649142, 0.008681926396190854, 0.009611149687530999, 0.009879476242436265, 0.010295853585953774, 0.011172254736633271, 0.010391578216446781, 0.013594881460172603, 0.012915881360976093, 0.013578266045035215, 0.013273484773335979, 0.013409631980954271, 0.014881708163872631, 0.015573851800416625, 0.01663277452633667, 0.01705559964289257, 0.017369804582878682, 0.01763813113778395, 0.018987947624243627, 0.0240278742188275, 0.021322785437952584, 0.022417170915583772, 0.02254811030651721, 0.024444251562345004, 0.0256343616704692, 0.027408987203650433, 0.03311923420295606, 0.030464735641305425, 0.030570379922626723, 0.035686687828588436, 0.03323207023112786, 0.03838136097609364, 0.03611496875309989, 0.03692887610356115, 0.03479441523658367, 0.03601949211387759, 0.038056988394008534, 0.04018177760142843, 0.0530559964289257, 0.004747048903878583, 0.0]
W_s_m = [0.003938676975916012, 0.003338078475470959, 0.0037091569507007624, 0.003704635279597231, 0.0039560401929535725, 0.004251034015747956, 0.00509640564526417, 0.004549343730684928, 0.004746790035539129, 0.0050357549635288035, 0.0059881394758285935, 0.005857915348046892, 0.006653970618060591, 0.005818184931283863, 0.007522372625730792, 0.007460033853450107, 0.0073911838747803375, 0.0074002272169874, 0.008269232114138072, 0.008616255299097089, 0.00953300904310105, 0.011188483267525936, 0.011782630850529953, 0.012592612867542529, 0.011814885437735142, 0.011690087315277677, 0.014204196737789138, 0.013437743341266555, 0.014431003760342268, 0.013151611993835093, 0.013879661330451683, 0.015190765083631623, 0.015376455043616642, 0.01590271727111964, 0.017072383152181122, 0.01795012994679862, 0.017975511593926442, 0.02037965397520002, 0.02339042375172336, 0.022627105380499227, 0.02330005061860078, 0.022175119136990235, 0.023688251155075956, 0.025032091807045465, 0.02642120945899833, 0.02895865070440401, 0.030566978971456077, 0.033580702906433724, 0.0382045034879568, 0.032982877697598834, 0.03709500597704631, 0.03501395206835706, 0.03473608030680805, 0.032527394695103115, 0.032248920044073634, 0.03579794954876134, 0.042141070350691166, 0.04383868654980096, 0.004816001747897182, 0.0]


def update_database(entry, ps):
    final_db.update({"_id": entry['_id']},
    {
        "forks": entry['forks'],
        "repo_created_at": entry['repo_created_at'],
        "repo_forks_count": entry['repo_forks_count'],
        "repo_language": entry['repo_language'],
        "repo_name": entry['repo_name'],
        "repo_stargazers_count": entry['repo_stargazers_count'],
        "repo_url": entry['repo_url'],
        "repo_watchers_count": entry['repo_watchers_count'],
        "stars": entry['stars'],
        "fork_array": entry['fork_array'],
        "star_array": entry['star_array'],
        "fork_array_one_week": entry['fork_array_one_week'],
        "star_array_one_week": entry['star_array_one_week'],
        "fork_array_two_weeks": entry['fork_array_two_weeks'],
        "star_array_two_weeks": entry['star_array_two_weeks'],
        "fork_array_three_weeks": entry['fork_array_three_weeks'],
        "star_array_three_weeks": entry['star_array_three_weeks'],
        "one_week_ps": entry['one_week_ps'],
        "two_weeks_ps": entry['two_weeks_ps'],
        "three_weeks_ps": entry['three_weeks_ps'],
        "monthly_ps": ps
    })



def calc_fork_star_weight():
    index = 0
    for e in final_db.find():
        for i in range (0, 88):
            totalMonthlyForks[i] += e['fork_array_two_weeks'][i]
            totalMonthlyStars[i] += e['star_array_two_weeks'][i]

        index +=1
        print index

    totalForks = sum(totalMonthlyForks)
    totalStars = sum(totalMonthlyStars)

    print totalMonthlyForks
    print totalMonthlyStars

    print '-'* 70

    print totalForks
    print totalStars

    print '-'* 70

    for k in range(0,len(totalMonthlyForks)):
        fork_weight[k] = float(totalMonthlyForks[k]) / float(totalForks)
        star_weight[k] = float(totalMonthlyStars[k]) / float(totalStars)

    print fork_weight
    print star_weight


def cal_monthly_ps():
    index = 0

    for e in final_db.find():
        l = len(W_f_m)
        pr = [0] * l
        for i in range (0, l-2):
            #WTP[R_i]
            pr[i] = (float(e['fork_array'][i])*float(W_f_m[i])) + (float(e['star_array'][i])*float(W_s_m[i]))

        ps = cal_overall_ps(pr)
        update_database(e, ps)

        index += 1
        print index


def cal_overall_ps(pr):
    l = len(W_f_m)
    ps = 0.0

    for i in range (0,l):
        ps += pr[i]

    return ps


if __name__ == "__main__":
    # calc_fork_star_weight()
    cal_monthly_ps()
